<mat-card class="example-card" (click)="toggleExpand($event)">
  <mat-card-header>
    <button mat-icon-button class="expand-button" (click)="toggleExpand($event); $event.stopPropagation()" color="primary" [attr.aria-label]="isExpanded ? 'Collapse' : 'Expand'">
      <mat-icon>{{ isExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
    </button>
    <mat-card-title class="card-title">
      <mat-chip-set aria-label="Programming language and category">
        <mat-chip [highlighted]="true" class="language-chip">
          {{ example.language }}
        </mat-chip>
        @for (category of example.categories; track category) {
          <mat-chip class="category-chip">
            {{ category }}
          </mat-chip>
        }
      </mat-chip-set>
      <div class="header-row">
        <span class="header-text">{{ example.header }}</span>
        @if (example.downloadUrl) {
          <a [href]="example.downloadUrl" download class="download-link" (click)="$event.stopPropagation()" [attr.aria-label]="'Download ' + example.header">
            <button mat-icon-button color="primary" matTooltip="Download example">
              <span class="download-text">DL full example</span>
              <mat-icon>download</mat-icon>
            </button>
          </a>
        }
      </div>
    </mat-card-title>
  </mat-card-header>
  
  @if (isExpanded) {
    <mat-card-content>
      @if (example.description) {
        <div class="example-description">
          <mat-icon class="description-icon">info</mat-icon>
          <span>{{ example.description }}</span>
        </div>
      }
      <div class="code-preview expanded">
        @for (section of highlightedSections; track $index; let i = $index) {
          <div class="code-section">
            @if (i > 0) {
              <hr class="section-separator">
            }
            <div class="section-header">
              <mat-chip class="section-title">{{ section.title }}</mat-chip>
            </div>
            @if (section.description) {
              <div class="section-description">
                <mat-icon class="description-icon">info</mat-icon>
                <span>{{ section.description }}</span>
              </div>
            }
            <div class="code-header">
              <div class="code-label">{{ section.codeLabel || 'Code' }}:</div>
              <button mat-icon-button class="copy-button" color="primary" disableRipple (click)="copySectionToClipboard(i); $event.stopPropagation()" [attr.aria-label]="copyStates[i].label" [matTooltip]="copyStates[i].label">
                <mat-icon>{{ copyStates[i].icon }}</mat-icon>
              </button>
            </div>
            <pre class="hljs"><code [innerHTML]="section.code"></code></pre>
            @if (section.usage) {
              <div class="usage-header">
                <div class="usage-label">Usage:</div>
                <button mat-icon-button class="copy-button" color="primary" disableRipple (click)="copyUsageToClipboard(i); $event.stopPropagation()" [attr.aria-label]="getUsageCopyState(i).label" [matTooltip]="getUsageCopyState(i).label">
                  <mat-icon>{{ getUsageCopyState(i).icon }}</mat-icon>
                </button>
              </div>
              <pre class="hljs usage-block"><code [innerHTML]="section.usage"></code></pre>
            }
            @if (section.output) {
              <div class="output-label">Output:</div>
              <pre class="hljs output-block"><code>{{ section.output }}</code></pre>
            }
          </div>
        }
      </div>
    </mat-card-content>
  }
</mat-card>
